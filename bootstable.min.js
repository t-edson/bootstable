"use strict";class bootstable{constructor(t,e){this.table=document.getElementById(t),this.headers=this._getTableHeaders(this.table),this.params=this._extend({columnsEd:[],$addButton:null,exportCsvButton:!1,exportJsonButton:!1,defaultValues:[],addButtonEdit:!0,buttons:null,customInputs:[],onEditSave:()=>{},onBeforeDelete:()=>!0,onDelete:()=>{},onAdd:()=>{}},e),this.colEdicHtml=document.createElement("td"),this.colEdicHtml.setAttribute("name","buttons"),this.colEdicHtml.appendChild(this._buildDefaultButtons(this.params.buttons)),this.SetEditable(t)}SetEditable(t){const e=document.createElement("th");if(e.style.whiteSpace="nowrap",e.style.width="6.3vw",e.setAttribute("name","buttons"),this.params.exportCsvButton){const s=document.createElement("button");s.className="btn btn-secondary btn-sm float-end",s.id="btnCsv",s.addEventListener("click",()=>{this.TableToCSV(t,",",!0,t+".export.csv")}),s.setAttribute("text","Export to CSV");const d=document.createElement("i");d.className="bi bi-file-spreadsheet",s.appendChild(d),e.appendChild(s)}if(this.params.exportCsvButton){const l=document.createElement("button");l.className="btn btn-secondary btn-sm float-end",l.id="btnJson",l.addEventListener("click",()=>{this.TableToJSON(t,!0,t+".export.csv")}),l.setAttribute("text","Export to JSON");const r=document.createElement("i");r.className="bi bi-file-code",l.appendChild(r),e.appendChild(l)}if(this.params.$addButton){const i=document.createElement("button");i.className="btn btn-success btn-sm float-end",i.id=this.params.$addButton,i.addEventListener("click",()=>{this.params.addButtonEdit?this.rowAddNewAndEdit(t,this.params.defaultValues):this.rowAddNew(t)}),i.setAttribute("text","Add New Row");const c=document.createElement("i");c.className="bi bi-plus",i.appendChild(c),e.appendChild(i)}document.querySelectorAll(`#${t} thead tr`)[0].appendChild(e);const n=document.querySelectorAll(`#${t} tbody tr`);for(var o=0;o<n.length;o++){var a=document.createElement("td");a.setAttribute("name","buttons"),a.appendChild(this._buildDefaultButtons(this.params.buttons)),n[o].appendChild(a)}null!=this.params.columnsEd&&(this.colsEdi=this.params.columnsEd)}IterarCamposEdit(t,e){var n=-1;for(const o of t)n++,"none"!=o.style.display&&"buttons"!=o.getAttribute("name")&&this.IsEditable(n)&&e(this,o,n)}IsEditable(t){return 0==this.colsEdi.length||this.colsEdi.includes(t)}ModoEdicion(t){return"editing"==t.id}SetButtonsNormal(t){var e;for(e of t.parentNode.childNodes)switch(e.id){case"bAcep":case"bCanc":e.style.display="none";break;case"bEdit":case"bElim":e.style.display="block"}t.parentNode.parentNode.parentNode.setAttribute("id","")}SetButtonsEdit(t){var e;for(e of t.parentNode.childNodes)switch(e.id){case"bAcep":case"bCanc":e.style.display="block";break;case"bEdit":case"bElim":e.style.display="none"}t.parentNode.parentNode.parentNode.setAttribute("id","editing")}butRowAcep(t){var e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");this.ModoEdicion(e)&&(this.IterarCamposEdit(n,function(t,e,n){var o=e.querySelector("input").value;e.innerHTML=o}),this.SetButtonsNormal(t),this.params.onEditSave(e))}butRowCancel(t){var e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");this.ModoEdicion(e)&&(this.IterarCamposEdit(n,function(t,e,n){var o=e.querySelector("div").innerHTML;e.innerHTML=o}),this.SetButtonsNormal(t))}butRowEdit(t){var l,e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");this.ModoEdicion(e)||(l=!1,this.IterarCamposEdit(n,function(t,e,n){var o=e.innerHTML;e.innerHTML="";var a=document.createElement("div");a.style.display="none";var s,d=document.createTextNode(o);a.appendChild(d),e.appendChild(a),t.customInputs&&0<t.customInputs.length?s=t._customInput(t,t.customInputs[n],o,n):((s=document.createElement("input")).className="form-control form-control-sm",s.value=o,s.setAttribute("name",t.headers[n])),e.appendChild(s),l||(e.querySelectorAll("input")[0].focus(),l=!0)}),this.SetButtonsEdit(t))}butRowDelete(t){t=t.parentNode.parentNode.parentNode;this.params.onBeforeDelete(t)&&(t.remove(),this.params.onDelete(t))}rowAddNew(t,e=[]){var n,o=document.getElementById(t),t=o.querySelectorAll("thead tr")[0].querySelectorAll("th"),a=0,s=document.createElement("tr");for(const d of t){if("none"==d.style.display){const l=document.createElement("td");l.style.display="none",l.setAttribute("role",d.getAttribute("role")),s.appendChild(l)}else if("buttons"==d.getAttribute("name"))s.appendChild(this.colEdicHtml);else{const r=document.createElement("td");a<e.length&&(n=document.createTextNode(e[a]),r.appendChild(n)),s.appendChild(r)}a++}o.querySelectorAll("tbody")[0].appendChild(s),this.params.onAdd(s)}rowAddNewAndEdit(t,e=[]){this.rowAddNew(t,e);t=document.getElementById(t).querySelectorAll("tbody")[0].lastChild;this.butRowEdit(t.querySelector("#bEdit"))}TableToCSV(t,e,n=!1,o=null){var a=[],s=document.getElementById(t),t=this._getTableHeaders(s);a.push(t);for(const r of s.querySelectorAll("tbody tr")){var d=r.querySelectorAll("td");a.push([]);for(const i of d)"buttons"!=i.getAttribute("name")&&a[a.length-1].push(i.innerHTML)}var l="";for(const c of a)l+=c.join(e)+"\n";return n&&o&&this._download(o,l,"application/csv"),l}TableToJson(t,e=!1,n=null){var o=[];const a=document.getElementById(t);var s=[];for(const l of a.querySelectorAll("thead tr th"))s.push(l.innerHTML);for(const r of a.querySelectorAll("tbody tr")){var d=0;o.push({});for(const i of r.querySelectorAll("td"))"buttons"!=i.getAttribute("name")&&(o[o.length-1][s[d]]=i.innerHTML,d++)}return e&&this._download(n,JSON.stringify(o),"application/json"),JSON.stringify(o)}_extend(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}_buildDefaultButtons(t={}){var e={bEdit:{className:"btn btn-sm btn-primary",icon:"bi bi-pencil",display:"block",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowEdit(e)}},bElim:{className:"btn btn-sm btn-danger",icon:"bi bi-trash",display:"block",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowDelete(e)}},bAcep:{className:"btn btn-sm btn-success",icon:"bi bi-check",display:"none",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowAcep(e)}},bCanc:{className:"btn btn-sm btn-warning",icon:"bi bi-x-circle",display:"none",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowCancel(e)}}};this.localbuttons=this._extend(e,t);const n=document.createElement("div");n.className="d-grid gap-2 d-md-flex justify-content-md-end";for(const o in this.localbuttons){const a=document.createElement("button");a.id=o,a.className=this.localbuttons[o].className,a.style.display=this.localbuttons[o].display,a.addEventListener("click",this.localbuttons[o].onclick);const s=document.createElement("i");s.className=this.localbuttons[o].icon,a.appendChild(s),n.appendChild(a)}return n}_download(t,e,n="text/plain"){var o=document.createElement("a");o.setAttribute("href",`data:${n};charset=utf-8,`+encodeURIComponent(e)),o.setAttribute("download",t),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}_getTableHeaders(t){var e=[];for(const n of t.querySelectorAll("thead tr th"))"buttons"!=n.getAttribute("name")&&e.push(n.innerHTML);return e}_customInput(t,e,n=null,o){const a=document.createElement(e.element);return"input"===a.element&&a.setAttribute("type",e.type),a.className=e.className,a.setAttribute("name",e.name),n?a.value=n:0<t.defaultValues.length&&(a.value=t.defaultValues[o]),a}}